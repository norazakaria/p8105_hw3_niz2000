---
title: "p8105_hw3_niz2000"
author: "Nora Zakaria"
date: "10/14/2019"
output: github_document
---

This first step loads the tidyverse into the markdown document. 
```{r}
library(tidyverse)
```

# Problem 1

## Load the Instacart Dataset
```{r}
library(p8105.datasets)
data("instacart")
instacart
```
The Instacart dataset was loaded, and consists of 1,384,617 observations and 17 variables relating to instacart products and orders. Key variables include the order_id, product_id, reordered, days_since_prior_order, product_name, and the department. Using the dataset, you can determine information about specific ordering behavior for an individual. For example, order identifier 1 (order_id) ordered product number 49302 (product_id=49302) Bulgarian Yogurt (product_name) from the dairy eggs department (department), and reordered the product an additional time (reordered). Order identifier 36 (order_id) ordered water seltzer sparkling water (product_name) from the beverages department (department), 7 days after their last instacart order (days_since_prior_order).

## How many aisles there are, and which aisles the most items are ordered from?
```{r}
instacart %>%
  count(aisle)  %>%
  arrange(desc(n)) 
```
The most items ordered were from the fresh vegetables and fresh fruits aisles, at 150,609 items and 150,473 items, respectively. The aisle with the next highest items ordered was the packaged vegetables fruits aisle, at 78,493 items.

## Plot demonstrating the number of items ordered in each aisle, limited to aisles with more than 10000 items ordered
```{r}
Aisle_items_plot = instacart %>%
  count(aisle) %>%
  filter(n > 10000) %>%
  arrange(desc(n)) %>%
  rename(n_items_ordered = n)

Aisle_items_plot %>%
  ggplot(aes(x = reorder(aisle, -n_items_ordered), y = n_items_ordered)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(
    title = "Items Ordered per Aisle",
    x = "Aisle Name",
    y = "Number of Items Ordered")
```

## 3 most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”
```{r}
instacart %>%
  group_by(product_name, aisle) %>%
  summarize(
    n_items_ordered = n()
    ) %>%
  group_by(aisle) %>%
  filter(
    aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits"),
    min_rank(desc(n_items_ordered)) <4 ) %>%
  arrange(n_items_ordered, aisle) %>%
  knitr::kable(format = 'pandoc' , caption = "Table: Most Popular Items by Aisle")
```


## Mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week
```{r}
instacart %>%
  select(product_name, order_dow, order_hour_of_day) %>% 
  filter(
    product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarise(mean_hour = mean(order_hour_of_day)) %>%
  mutate(
    day_of_week = recode(order_dow,
      `0` = "Sunday",
      `1` = "Monday",
      `2` = "Tuesday",
      `3` = "Wednesday",
      `4` = "Thursday",
      `5` = "Friday",
      `6` = "Saturday")) %>%
  select(product_name, day_of_week, mean_hour) %>% 
  pivot_wider(
    names_from = "day_of_week",
    values_from = "mean_hour") %>% 
  knitr::kable(format= 'pandoc', caption = "Table: Mean Hour Pink Lady Apples and Coffee Ice Cream are Ordered")
```


# Problem 2

## Load BRFSS Dataset
```{r}
library(p8105.datasets)
data("brfss_smart2010")
```

## Clean the BRFSS Dataset
```{r}
brfss = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  select(-data_value_footnote_symbol, -data_value_footnote, -location_id) %>%
  drop_na(response) %>%
  mutate(response = as.factor(response),
         response = factor(response,
                           levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>%
  rename(
    location_state= locationabbr,
    location_county= locationdesc)
brfss
```
BRFSS is a continuous, state-based surveillance system that collects information about modifiable risk factors for chronic diseases and other leading causes of death.

## In 2002, which states were observed at 7 or more locations? What about in 2010?
```{r}
# Restricting to 2002
location_2002 = brfss %>%
  filter(year == "2002") %>%
  distinct(location_state, location_county) %>%
  count(location_state) %>%
  filter(n >= 7) %>%
  rename(number_sites = n)
location_2002 

# Restricting to 2010
location_2010 = brfss %>%
  filter(year == "2010") %>%
  distinct(location_state, location_county) %>%
  count(location_state) %>%
  filter(n >= 7) %>%
  rename(number_sites = n)
location_2010
```

## Construct a dataset that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. Make a “spaghetti” plot of this average value over time within a state (that is, make a plot showing a line for each state across years – the geom_line geometry and group aesthetic will help)
```{r}
excellent_responses = brfss %>%
  filter(response == "Excellent") %>%
  group_by(year, location_state) %>%
  summarise(
    mean_data_value = mean(data_value)) %>%
  ggplot(aes(x = year, y = mean_data_value, group = location_state, color = location_state)) +
    geom_line()+
    labs(title = "Average Data Value for Excellent Responses Over Time Within a State")
excellent_responses
```

## Make a two-panel plot showing, for the years 2006, and 2010, distribution of data_value for responses (“Poor” to “Excellent”) among locations in NY State
```{r}
responses_2006_2010 = brfss %>%
  filter(location_state == "NY",
        year %in% c("2006", "2010")) %>%
  select(year, response, data_value) %>%
  ggplot(aes(x = response, y = data_value)) +
    geom_boxplot() +
    facet_grid(~year) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
    labs(title = "Distribution of Data Values for Responses in NY State")
responses_2006_2010
```


# Problem 3

## Load and Tidy the Accelerometer Data 
```{r}
accelerometer = 
  read_csv(file = "./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  mutate(
    day_type = if_else(day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"), "weekday", day),
    day_type = if_else(day %in% c("Saturday", "Sunday"), "weekend", day_type)) %>%
  rename(
    day_number = day_id,
    day_of_the_week= day) %>%
  select(week, day_number, day_of_the_week, day_type, activity_1:activity_1440)
accelerometer
```




```{r}
accelerometer = 
  read_csv(file = "./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  mutate(day_type = case_when(day %in% c("monday", "tuesday", "wednesday", "thursday", "friday") ~ 'weekday',
                              day %in% c("saturday", "sunday") ~ 'weekend')) %>%
  rename(
    day_number = day_id,
    day_of_the_week= day) %>%
  select(week, day_number, day_of_the_week, day_type, activity_1:activity_1440)
accelerometer
```


```{r}
accelerometer = 
  read_csv(file = "./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  mutate(
    day_type = if_else(day %in% c("monday", "tuesday", "wednesday", "thursday", "friday"), "weekday", day),
    day_type = if_else(day_type %in% c("saturday", "sunday"), "weekend", day_type)) %>%
  rename(
    day_number = day_id,
    day_of_the_week= day) %>%
  select(week, day_number, day_of_the_week, day_type, activity_1:activity_1440)
accelerometer
```

```{r}
accelerometer = 
  read_csv(file = "./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  rename(
    day_number = day_id,
    day_of_the_week= day) 
accelerometer
```

```{r}
accelerometer = 
  read_csv(file = "./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  rename(
    day_number = day_id,
    day_of_the_week= day) 
accelerometer

%>%
  mutate(
    day_type = if_else(day_of_the_week %in% c("saturday", "sunday"), "weekend",
          "weekday")) %>%
  #mutate(
  #  day_type = if_else(day_of_the_week %in% c("saturday", "sunday"), "weekend", day_of_the_week),
  #  day_type = if_else(day_of_the_week %in% c("monday", "tuesday", "wednesday", "thursday", "friday"), "weekday", day_of_the_week)) %>%
  select(week, day_number, day_of_the_week, day_type, activity_1:activity_1440)
accelerometer

#  pivot_longer(
   # activity_1:activity_1440,
   # names_to = "activity_number",
   # values_to = "activity") 
```
if_else(day_of_the_week %in% c("monday", "tuesday", "wednesday", "thursday", "friday"), 

  mutate(day_type = if_else(day_of_the_week %in% c("saturday", "sunday"), "weekend",
         "weekday"))